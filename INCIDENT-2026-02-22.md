# Incident Report - 2026-02-22

## What Broke
AI Manus stopped working with "404 Not Found" errors and "dev-sandbox container not found" errors.

## Why It Broke (Root Causes)

### 1. System Prompt Modification Side Effects
- **What I did:** Modified `backend/app/domain/services/prompts/system.py` to simplify Manus's verbose system prompt
- **Why it broke:** The backend container was already running with the old configuration. When I tried to restart it to load the new prompt, the container recreation caused state issues.

### 2. Docker Compose Configuration Mismatch
- **What I did:** Started using `docker-compose.yml` instead of `docker-compose-development.yml`
- **Why it broke:** 
  - Production compose uses pre-built frontend image that can't properly proxy to backend
  - Development compose uses `frontend-dev` service with Vite dev server
  - API routes are at `/api/v1/` but frontend wasn't configured correctly

### 3. Orphan Containers
- Previous containers (`frontend-dev`, `mockserver`) were left running while trying to start new ones
- Created network conflicts and port issues

## How I Fixed It

### Step 1: Clean Shutdown
```bash
cd ~/ai-manus
docker-compose -f docker-compose-development.yml down
```
Stopped all containers properly.

### Step 2: Restore Original Config
- Reverted `docker-compose.yml` back to original state
- Kept the simplified system prompt in `backend/app/domain/services/prompts/system.py`

### Step 3: Start Development Stack
```bash
cd ~/ai-manus
docker-compose -f docker-compose-development.yml up -d
```

This starts:
- `frontend-dev`: Vite dev server on port 5173
- `backend`: Python/FastAPI on port 8000 (with hot reload)
- `sandbox`: Browser sandbox on port 8080
- `mockserver`: Mock API server
- `mongodb`: Database on port 27017
- `redis`: Cache

### Step 4: Verified Working
- Frontend: http://localhost:5173 ✓
- Backend API: http://localhost:8000 ✓
- Authentication working ✓

## Key Lessons

1. **Always use development compose** when you've mounted local source code
   - `docker-compose-development.yml` has hot-reload and proper volume mounts
   - Changes to `backend/` code are reflected immediately

2. **Don't switch between compose files**
   - Development and production configs are different
   - Mixing them creates network/proxy issues

3. **Check for orphan containers**
   - Run `docker ps` to see what's actually running
   - Use `--remove-orphans` flag when switching configs

4. **Simplified prompt is now active**
   - Location: `backend/app/domain/services/prompts/system.py`
   - Should make Manus less verbose (testing needed)

## Files Modified

1. `backend/app/domain/services/prompts/system.py` - Simplified system prompt
2. `INCIDENT-2026-02-22.md` - This file

## Current State

All services running:
- Frontend: http://localhost:5173
- Login: admin@example.com / admin123
- Backend: http://localhost:8000
- 6 containers active

## Backups Created

Both configs saved to GitHub:
- AI Manus: https://github.com/rynky2436/ai-manus
- OpenClaw: https://github.com/rynky2436/openclaw-setup
